= Rancher RBAC
:revdate: 2025-07-10
:page-revdate: {revdate}
:description: SUSE Observability 自助托管

== 概述

SUSE Rancher Prime Observability 扩展使用 Kubernetes RBAC 向 SUSE Observability 中的 Rancher 用户授予访问权限。
如果不使用 Rancher，请参阅xref:/setup/security/rbac/rbac_roles.adoc[如何]在独立安装中xref:/setup/security/rbac/rbac_roles.adoc[设置角色]。

[NOTE]
====
要使 Rancher RBAC 正常运行、

* {stackstate-product-name} 的身份验证必须通过xref:setup/security/authentication/oidc.adoc#_rancher[Rancher OIDC Provider] 进行配置。
* {stackstate-product-name} Agent 必须启用 RBAC Agent，并且必须使用服务令牌进行身份验证。
====

每个通过身份验证的用户都拥有允许他们使用系统的 "*实例基本访问*"角色。 这些权限允许用户访问视图、设置、度量绑定，并查看系统通知。 它们不允许访问任何{stackstate-product-name} 数据。 要查看任何数据，用户需要被赋予额外的角色。Rancher 角色*模板*提供了扩展 "*实例基本访问*"角色的两个方向：

实例角色:: 使您能够配置或个性化{stackstate-product-name} 。
范围角色:: 允许访问来自观测集群的{stackstate-product-name} 数据。

== 实例角色

您可以将*实例角色*的*角色模板*分配给运行{stackstate-product-name} 的*项目*中的用户或组。如果没有为项目成员明确分配实例角色，那么他们将拥有实例*基本访问*角色的权限。

=== 可访问{stackstate-product-name} 数据的实例角色

几个 "全局 "角色允许访问所有{stackstate-product-name} 数据\--在任何观察到的集群中。 这些角色用于设置系统和排除系统级问题。 对于具有这些角色的用户，没有必要配置 "xref:scoped[作用域角色]"。

实例管理:: 授予对所有视图和所有权限的完全访问权。
实例故障排除器:: 授予使用 SUSE Observability 进行故障排除所需的所有权限，包括启用/禁用监控器、创建自定义视图和使用 CLI 的权限。
实例观察员:: 允许访问 SUSE Observability 实例中的所有数据。

=== 无法访问{stackstate-product-name} 数据的实例角色

这些角色需要与 "*实例观察者*"角色或某个 "xref:scoped[作用域]角色"（见下文）结合使用。 否则，将无法访问{stackstate-product-name} 数据，用户界面将显示 "未找到组件 "信息。 这适用于所有 Rancher 用户，包括项目所有者等用户。

建议访问的实例:: 授予使用 SUSE Observability 的建议权限。 该角色包括并非严格必要的权限，但可提供（有限的）个性化手段{stackstate-product-name} 。
实例基本访问:: 授予使用{stackstate-product-name} 的最低权限。该角色无需明确分配，也没有*角色模板*，每个登录用户都拥有该角色。

您可以在下面找到分配给每个预定义 SUSE Observability 角色的权限。有关不同权限以及如何使用`sts` CLI 管理这些权限的详细信息，请参阅xref:/setup/security/rbac/rbac_permissions.adoc[基于角色的访问控制 (RBAC) 权限]。

[tabs]
====
基本访问::
+
--
基本访问权限授予使用 SUSE Observability 的最低权限。与观察者（实例、群集或项目）相结合。
这些权限授予所有用户。

|===
|资源 |动词 

|度量绑定 |获取
|设置 |获取
|system-notifications |获取
|观点 |获取
|===

--
建议访问::
+
--
推荐访问权限授予的权限并非绝对必要，但却能让 SUSE Observability 变得更加有用。它提供的个性化程度有限。
与观察者（实例、群集或项目）相结合。

|===
|资源 |动词 

|api-tokens |获取
|favorite-dashboards |创建、删除
|favorite-views |创建、删除
|背包 |获取 
|visualization-settings |更新
|===

--
观察员::
+
--
Observer 允许访问 SUSE Observability 实例中的所有可观察性数据。 与*"推荐访问 "*结合使用，体验更佳。

|===
|资源 |动词 

|拓扑学 |获取
|度量 |获取
|蛛丝马迹 |获取
|===

--
故障排除员::
+
--
故障排除员角色可访问 SUSE Observability 中的所有可用数据，并能创建视图和启用/禁用监控器。

|===
|资源 |动词 

|代理人 |获取 
|api-tokens |获取
|组件-动作 |执行
|仪表盘 |获取、创建、更新、删除 
|favorite-dashboards |创建、删除
|favorite-views |创建、删除
|度量绑定 |获取
|度量 |获取 
|显示器 |获取、创建、更新、删除、执行 
|通知 |获取、创建、更新、删除 
|设置 |获取 
|stackpack-configurations |获取、创建、更新、删除
|背包 |获取 
|system-notifications |获取
|拓扑学 |获取 
|蛛丝马迹 |获取 
|观点 |获取、创建、更新、删除 
|visualization-settings |获取
|===

--
管理员::
+
--
管理员角色已分配了所有权限。

|===
|资源 |动词 

|代理人 |获取 
|api-tokens |获取
|组件-动作 |执行
|仪表盘 |获取、创建、更新、删除 
|favorite-dashboards |创建、删除
|favorite-views |创建、删除
|键 |获取、创建、更新、删除
|度量绑定 |获取
|度量 |获取 
|显示器 |获取、创建、更新、删除、执行 
|通知 |获取、创建、更新、删除 
|权限 |获取、创建、更新、删除 
|限制脚本 |执行
|service-tokens |获取、创建、更新、删除
|设置 |获取、创建、更新、删除、解锁 
|stackpack-configurations |获取、创建、更新、删除
|背包 |获取、创建 
|sync-data |获取、更新、删除
|system-notifications |获取
|主题消息 |获取
|拓扑学 |获取 
|蛛丝马迹 |获取 
|观点 |获取、创建、更新、删除 
|visualization-settings |更新
|===

--
====

[#scoped]
== 范围角色

您可以为观察群集中的用户或组分配以下*角色模板*。 它们允许用户访问来自{stackstate-product-name} 的数据（*群集*中的*项目*），允许用户读取拓扑、度量、日志和跟踪数据。

观察员:: 允许访问*项目*中来自命名空间的数据。您可以在群集配置的 "*项目成员资格*"部分使用该选项。
群组观察员:: 允许访问来自*群集*的所有数据。您可以在群集配置的*群集成员资格*部分使用此模板。

这些角色中的资源与xref:/setup/security/rbac/rbac_permissions.adoc#_scoped_permissions[范围权限]相对应。它们可在`scope.observability.cattle.io` API 组中找到（只有动词`get` ，因为这些资源是只读的）：

* `topology` - 群集或命名空间中的组件（部署、pod 等
* `traces` - 集群或命名空间的跨
* `metrics` - 来自群集或命名空间的度量数据

请注意，日志的访问受`topology` 资源控制。

通过在运行{stackstate-product-name} 的*项目*上授予 "*实例推荐访问*"角色，为具有这些观察者角色的用户启用个性化。

== 自定义角色

要授予 "建议访问 "之外的其他权限，请在 Rancher 中创建一个自定义项目*角色模板*，继承*SUSE Observability Instance 的 "建议访问*"。 例如，要授予查看监控器和度量图表的权限，可添加以下规则：

* 动词： `get`
* 资源：`metricbindings` 和 `monitors`
* ApiGroup： `instance.observability.cattle.io`

image::rancher-custom-role.png[自定义角色模板，提供更丰富的访问权限]

您可以指定xref:/setup/security/rbac/rbac_permissions.adoc[RBAC 权限]中定义的任何资源和动词组合。 请注意，资源名称中的破折号 (`-`) 被去掉了，因此权限`get-metric-bindings` 变成了带有动词`get` 的 Kubernetes RBAC 资源`metricbindings` 。


== 故障排除

* 验证群集的 Rbac 代理能否与平台通信。

* xref:/setup/security/rbac/rbac_permissions.adoc#_list_subjects_for_a_user[检查用户主体]（用户和角色）。
  ** 验证 OIDC 提供程序上的任何角色配置。
* xref:/setup/security/rbac/rbac_permissions.adoc#_show_granted_permissions[检查主体许可]
  ** 验证是否存在将用户与（群集）角色相匹配的相关（群集）角色绑定。
  ** 检查（群组）角色，确认其授予的权限是否正确。
