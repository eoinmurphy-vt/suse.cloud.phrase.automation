= Sincronização de Saúde
:revdate: 2025-07-10
:page-revdate: {revdate}
:description: SUSE Observability

Esta seção descreve o tópico avançado de sincronização de dados de saúde personalizados de diferentes sistemas de monitoramento no SUSE Observability.
Este tópico é principalmente interessante para engenheiros que desejam fazer uma integração personalizada com um sistema de monitoramento existente.
Para monitores prontos para uso, você pode conferir xref:/use/alerting/kubernetes-monitors.adoc[aqui].

== Visão Geral

A sincronização de saúde adiciona verificações de saúde existentes de sistemas de monitoramento externos aos elementos de topologia do SUSE Observability. Os dados de saúde são calculados no sistema de monitoramento externo usando seus próprios dados e regras e depois sincronizados automaticamente e anexados aos elementos de topologia associados no SUSE Observability.

== Configurar a sincronização de saúde

A SUSE Observability Receiver API receberá e processará automaticamente todos os dados de saúde recebidos. O SUSE Observability não requer configuração adicional para habilitar a sincronização de saúde, no entanto, os dados de saúde recebidos devem corresponder ao formato JSON esperado.

Detalhes sobre como ingerir dados de saúde podem ser encontrados nas seguintes páginas:

* xref:/configure/health/send-health-data/send-health-data.adoc[Coletar dados de saúde por meio da API do SUSE Observability Receiver]

== Pipeline de sincronização de saúde

O framework de sincronização de saúde funciona da seguinte forma:

* Os dados de saúde são enviados para o SUSE Observability e ingeridos por meio da Receiver API.
* Os elementos de topologia do SUSE Observability relacionados às verificações de saúde ingeridas são identificados e vinculados com base em :
 ** Os identificadores de topologia obtidos durante a sincronização de topologia.
 ** o `topologyElementIdentifier` do xref:/configure/health/send-health-data/send-health-data.adoc#_json_health_payload[payload de saúde] ingerido.
* SUSE Observability acompanha as mudanças tanto nos elementos de topologia quanto nas verificações de saúde para manter informações atualizadas.

image::health-sync-pipeline.svg[Pipeline de sincronização de saúde]

=== Modelos de consistência

A sincronização de saúde do SUSE Observability depende de diferentes modelos de consistência para garantir que os dados enviados de um sistema de monitoramento externo correspondam ao que o SUSE Observability ingere e exibe. O modelo de consistência é especificado na propriedade `"health"` do xref:/configure/health/send-health-data/send-health-data.adoc#_common_json_object[objeto JSON comum] ou como um argumento na CLI do SUSE Observability quando os dados de saúde são enviados para o SUSE Observability. Os modelos suportados são: `REPEAT_SNAPSHOTS` e `TRANSACTIONAL_INCREMENTS`.
[tabs]
====
Modelo de snapshots repetidos::
+
--
O modelo de consistência `REPEAT_SNAPSHOTS` funciona com instantâneas completas e periódicas de todas as verificações em um sistema de monitoramento externo. O SUSE Observability acompanha as verificações em cada instantânea recebida e decide se os estados de verificação externos associados precisam ser criados, atualizados ou excluídos no SUSE Observability. Por exemplo, se um estado de verificação não estiver mais presente em uma instantânea. Este modelo oferece controle total sobre quais verificações externas serão excluídas, pois todas as decisões são inferidas das instantâneas recebidas. Não há ambiguidade sobre as verificações externas que estarão presentes no SUSE Observability.

*Use este modelo quando:* O sistema de monitoramento externo é capaz de manter o estado de quais elementos estão presentes em uma janela de tempo determinada e, portanto, pode comunicar como o snapshot completo se apresenta.

*Carga útil JSON:* A xref:/configure/health/send-health-data/repeat_snapshots.adoc[carga útil de saúde de Instantâneas Repetidas] aceita propriedades específicas para especificar quando uma instantânea começa ou termina.
--

Modelo de Incrementos transacionais::
+
--
O modelo de consistência `TRANSACTIONAL_INCREMENTS` é projetado para ser usado em sistemas de streaming onde apenas mudanças incrementais são comunicadas ao SUSE Observability. Como não há repetição de dados, a consistência dos dados é mantida ao garantir que a entrega pelo menos uma vez seja assegurada em todo o pipeline. Para detectar se algum dado está faltando, o SUSE Observability requer que tanto um ponto de verificação quanto o ponto de verificação anterior sejam comunicados junto com `check_states`. Este modelo requer controle rigoroso em todo o pipeline para garantir que não haja perda de dados.

*Use este modelo quando:* O sistema de monitoramento externo não tem acesso ao estado total das verificações externas, mas funciona apenas com uma abordagem baseada em eventos.

*Carga útil JSON:* Os metadados `repeat_interval` e `expire_interval` não são relevantes para o xref:/configure/health/send-health-data/transactional_increments.adoc[payload de Incrementos Transacionais], pois não há periodicidade predefinida nos dados.

--
====

=== Fluxo de saúde e subfluxo

Sistemas de monitoramento externos enviam dados de saúde para o SUSE Observability Receiver em um fluxo de saúde. Cada fluxo de saúde tem pelo menos um subfluxo com verificações de saúde.

==== Fluxo de Saúde

O fluxo de saúde identifica exclusivamente a sincronização de saúde e define os limites dentro dos quais os estados das verificações de saúde devem ser processados juntos.

==== Subfluxo de saúde

Subfluxos contêm os dados de verificação de saúde que são processados pelo SUSE Observability. Ao trabalhar com dados de saúde de um sistema de monitoramento externo distribuído, múltiplos subfluxos podem ser configurados, cada um contendo instantâneos de saúde de um único local. Os dados em cada subfluxo são semi-independentes, mas contribuem para os estados de verificação de saúde do fluxo de saúde completo. Se uma única localização for responsável por relatar os estados das verificações de saúde do fluxo de saúde, você pode omitir o `sub_stream_id` do xref:/configure/health/send-health-data/send-health-data.adoc#_json_health_payload[payload de saúde]. SUSE Observability assumirá que todas as verificações de saúde externas pertencem a um único subfluxo padrão.

=== Intervalo de Repetição

A sincronização de saúde processa os dados de saúde ingeridos por subfluxo. O intervalo de repetição especificado no xref:/configure/health/send-health-data/send-health-data.adoc#_json_health_payload[health payload] é o compromisso do sistema de monitoramento externo de enviar instantâneas completas repetidamente para manter os dados atualizados no SUSE Observability. Isso é útil para que o SUSE Observability possa informar ao usuário quão atualizada está a execução da sincronização de saúde.

=== Intervalo de Expiração

O intervalo de expiração pode ser usado para configurar os subfluxos na sincronização de saúde para excluir dados que não são mais enviados pelo sistema externo. Isso é útil caso a fonte de um subfluxo possa ser desativada e SUSE Observability não ouça mais sobre ela. Sem um intervalo de expiração, os dados sincronizados anteriormente ficariam pendentes\&nbsp;permanentemente.

=== Estado da verificação de saúde

O estado da verificação de saúde é calculado por um sistema de monitoramento externo e inclui todas as informações necessárias para associá-lo a um elemento de topologia. Para poder materializá-lo e vinculá-lo a um componente, é necessário atribuir o estado de saúde a um monitor específico: neste caso, um <<_external_monitor,ExternalMonitor>>.

Uma vez vinculado a um elemento de topologia, o estado da verificação de saúde contribui para o próprio estado de saúde do elemento.

=== Monitor Externo

Um monitor externo permite anexar os estados de saúde a componentes e mostrar um remediationHint nas páginas de destaque do SUSE Observability. Este recurso precisa ser criado via xref:/setup/cli/cli-sts.adoc[SUSE Observability CLI] ou como parte de um stackpack. Aqui está um exemplo de monitor externo:

----
    {
      "_type": "ExternalMonitor",
      "healthStreamUrn": "urn:health:kubernetes:external-health",
      "description": "Monitored by external tool.",
      "identifier": "urn:custom:external-monitor:heartbeat",
      "name": "External Monitor Heartbeat",
      "remediationHint": "",
      "tags": [
        "heartbeat"
      ]
    }
----

Cada `ExternalMonitor` carga útil contém as seguintes informações:

* `_type`: O SUSE Observability precisa saber que isso é um monitor, então o valor sempre precisa ser `ExternalMonitor`.
* `healthStreamUrn`: Este campo precisa corresponder ao `urn` que é enviado como parte do xref:/configure/health/send-health-data/repeat_snapshots.adoc#_json_property_health[Health Payload].
* `description`: Uma descrição do monitor externo.
* `identifier`: Um identificador no formato `urn:custom:external-monitor:....` que identifica exclusivamente o monitor externo ao atualizar a configuração.
* `name`: O nome do monitor externo
* `remediationHint`: Uma descrição do que o usuário pode fazer quando o monitor falha. O formato é markdown.
* `tags`: Adicione tags ao monitor para ajudar a organizá-lo na visão geral dos monitores da sua instância SUSE Observability, http://your-SUSE Observability-instance/#/monitors

Aqui está um exemplo de como criar um `External Monitor` usando o xref:/setup/cli/cli-sts.adoc[SUSE Observability CLI]

* Crie um novo arquivo YAML chamado `externalMonitor.yaml` e adicione este template YAML nele para criar seu próprio monitor externo.
```
nodes:
* _type: ExternalMonitor
healthStreamUrn: urn:health:sourceId:streamId
description: Monitored by external tool.
identifier: urn:custom:external-monitor:heartbeat
name: External Monitor Heartbeat
remediationHint: |-
  To remedy this issue with the deployment {{ labels.deployment }}, consider taking the following steps:
 .. Look at the logs of the pods created by the deployment
tags:
  *** heartbeat
```
* Use o CLI para criar o monitor externo
```bash
sts settings apply -f externalMonitor.yaml
✅ Applied 1 setting node(s).

TYPE            | ID              | IDENTIFIER                            | NAME                    +
ExternalMonitor | 150031117290020 | urn:custom:external-monitor:heartbeat | External Monitor Heartbeat
```

== Consulte também

* xref:/configure/health/send-health-data/send-health-data.adoc#_json_health_payload[Payload de saúde JSON]
