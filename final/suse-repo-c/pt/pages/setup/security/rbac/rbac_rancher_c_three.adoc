= Rancher RBAC
:revdate: 2025-07-10
:page-revdate: {revdate}
:description: SUSE Observability Self-hosted

== Visão geral

A extensão do SUSE Rancher Prime Observability usa o Kubernetes RBAC para conceder acesso aos usuários do Rancher no SUSE Observability.
Se você não usa o Rancher, consulte xref:/setup/security/rbac/rbac_roles.adoc[Como configurar funções] em uma instalação autônoma.

[NOTE]
====
Para que o RBAC do Rancher funcione, 

* A autenticação para {stackstate-product-name} deve ser configurada com o xref:setup/security/authentication/oidc.adoc#_rancher[provedor OIDC do Rancher].
* O agente {stackstate-product-name} deve ter o agente RBAC ativado e deve se autenticar usando um token de serviço.
====

Todo usuário autenticado tem a função *Instance Basic Access* que lhe permite usar o sistema.  Essas permissões fornecem acesso a visualizações, configurações, vinculações de métricas e permitem que o usuário veja as notificações do sistema.  Eles NÃO concedem acesso a nenhum dado do site {stackstate-product-name}.  Para ver qualquer dado, o usuário precisa receber uma função adicional. Duas direções para estender a função *Instance Basic Access* são fornecidas com os *modelos de função* do Rancher:

Funções de instância:: Permite que você configure ou personalize o site {stackstate-product-name}.
Funções com escopo:: Concede acesso a {stackstate-product-name} dados de clusters observados.

== Funções de instância

Você pode atribuir os *modelos de função* para *funções de instância* a usuários ou grupos no *projeto* que está executando {stackstate-product-name}. Se nenhuma função de instância for explicitamente atribuída a um membro de um projeto, ele terá as permissões da função *Acesso básico à instância*.

=== Funções de instância com acesso aos dados de {stackstate-product-name} 

Algumas funções "globais" permitem o acesso a todos os dados do {stackstate-product-name} - em qualquer um dos clusters observados.  Essas funções devem ser usadas para configurar o sistema e solucionar problemas no nível do sistema.  Para usuários com qualquer uma dessas funções, não é necessário configurar xref:scoped[funções com escopo].

Administrador da instância:: Concede acesso total a todas as visualizações e a todas as permissões.
Solucionador de problemas de instância:: Concede todas as permissões necessárias para usar o SUSE Observability para solução de problemas, incluindo a capacidade de ativar/desativar monitores, criar exibições personalizadas e usar a CLI.
Observador de instância:: Concede acesso a todos os dados em uma instância do SUSE Observability.

=== Funções de instância sem acesso aos dados de {stackstate-product-name} 

Essas funções precisam ser combinadas com a função *Observador de instância* ou uma das xref:scoped[funções com escopo] (veja abaixo).  Caso contrário, nenhum dado do {stackstate-product-name} estará acessível e a interface do usuário exibirá a mensagem "Nenhum componente encontrado".  Isso se aplica a todos os usuários do Rancher, inclusive usuários, como proprietários de projetos.

Instância Acesso recomendado:: Concede as permissões recomendadas para usar o SUSE Observability.  Essa função inclui permissões que não são estritamente necessárias, mas fornecem meios (limitados) de personalização {stackstate-product-name}.
Acesso básico à instância:: Concede permissões mínimas para usar o site {stackstate-product-name}. Essa função não precisa ser explicitamente atribuída e não há um *modelo de função* para ela; todos os usuários conectados a possuem. 

Você pode encontrar as permissões atribuídas a cada função predefinida do SUSE Observability abaixo. Para obter detalhes sobre as diferentes permissões e como gerenciá-las usando a CLI do `sts`, consulte xref:/setup/security/rbac/rbac_permissions.adoc[Permissões de controle de acesso baseado em função (RBAC)]

[tabs]
====
Acesso básico::
+
--
O acesso básico concede permissões mínimas para o uso do SUSE Observability. Para ser combinado com um Observador (Instância, Cluster ou Projeto).
Essas permissões são concedidas a todos os usuários.

|===
|Recursos |Verbos 

|vínculos métricos |obter
|configurações |obter
|notificações de sistema |obter
|visualizações |obter
|===

--
Acesso recomendado::
+
--
O acesso recomendado concede permissões que não são estritamente necessárias, mas que tornam o SUSE Observability muito mais útil. Ele oferece um grau limitado de personalização.
Para ser combinado com um Observador (Instância, Cluster ou Projeto).

|===
|Recursos |Verbos 

|api-tokens |obter
|painéis favoritos |criar, excluir
|visualizações favoritas |criar, excluir
|mochilas |obter 
|configurações de visualização |atualização
|===

--
Observador::
+
--
O Observer concede acesso a todos os dados de observabilidade em uma instância do SUSE Observability.  Combine com o *Recommended Access* para ter uma experiência melhor.

|===
|Recursos |Verbos 

|topologia |obter
|métricas |obter
|rastros |obter
|===

--
Solucionador de problemas::
+
--
A função de solucionador de problemas tem acesso a todos os dados disponíveis no SUSE Observability e a capacidade de criar exibições e ativar/desativar monitores.

|===
|Recursos |Verbos 

|agentes |obter 
|api-tokens |obter
|ações de componentes |executar
|painéis de controle |obter, criar, atualizar, excluir 
|painéis favoritos |criar, excluir
|visualizações favoritas |criar, excluir
|vínculos métricos |obter
|métricas |obter 
|monitores |obter, criar, atualizar, excluir, executar 
|notificações |obter, criar, atualizar, excluir 
|configurações |obter 
|stackpack-configurations |obter, criar, atualizar, excluir
|mochilas |obter 
|notificações de sistema |obter
|topologia |obter 
|rastros |obter 
|visualizações |obter, criar, atualizar, excluir 
|configurações de visualização |obter
|===

--
Administrador::
+
--
A função Administrador tem todas as permissões atribuídas.

|===
|Recursos |Verbos 

|agentes |obter 
|api-tokens |obter
|ações de componentes |executar
|painéis de controle |obter, criar, atualizar, excluir 
|painéis favoritos |criar, excluir
|visualizações favoritas |criar, excluir
|ingestion-api-keys |obter, criar, atualizar, excluir
|vínculos métricos |obter
|métricas |obter 
|monitores |obter, criar, atualizar, excluir, executar 
|notificações |obter, criar, atualizar, excluir 
|permissões |obter, criar, atualizar, excluir 
|scripts restritos |executar
|service-tokens |obter, criar, atualizar, excluir
|configurações |obter, criar, atualizar, excluir, desbloquear 
|stackpack-configurations |obter, criar, atualizar, excluir
|mochilas |obter, criar 
|sync-data |obter, atualizar, excluir
|notificações de sistema |obter
|mensagens de tópico |obter
|topologia |obter 
|rastros |obter 
|visualizações |obter, criar, atualizar, excluir 
|configurações de visualização |atualização
|===

--
====

[#scoped]
== Funções com escopo

É possível atribuir os seguintes *modelos de função* a usuários ou grupos em um cluster observado.  Eles concedem acesso a {stackstate-product-name} dados provenientes de (um *projeto* em) o *cluster*, dando a um usuário permissão para ler topologia, métricas, registros e dados de rastreamento.

Observador:: Concede acesso a dados provenientes de namespaces em um *projeto*. Você pode usar isso na seção *Project Membership* da configuração do cluster.
Observador de cluster:: Concede acesso a todos os dados provenientes de um *cluster*. É possível usar esse modelo na seção *Associação* do cluster da configuração do cluster.

Os recursos nessas funções correspondem às xref:/setup/security/rbac/rbac_permissions.adoc#_scoped_permissions[permissões com escopo]. Eles estão disponíveis no `scope.observability.cattle.io` API Group (apenas com o verbo `get`, pois esses recursos são somente de leitura):

* `topology` - componentes (implantações, pods, etc.) do cluster ou namespace
* `traces` - abrange o cluster ou o namespace
* `metrics` - dados métricos originados do cluster ou namespace

Observe que o acesso aos registros é controlado pelo recurso `topology`.

Habilite a personalização para usuários com essas funções de observador concedendo a função *Instance Recommended Access* no *projeto* que está executando {stackstate-product-name}.

== Funções personalizadas

Para conceder permissões adicionais além do Recommended Access, crie um Project *RoleTemplate* personalizado no Rancher, herdando o *SUSE Observability Instance Recommended Access*.  Então, por exemplo, para conceder os direitos de visualização de monitores e gráficos de métricas, adicione regras com:

* Verbo: `get`
* Recurso: `metricbindings` e `monitors`
* ApiGroup: `instance.observability.cattle.io`

image::rancher-custom-role.png[RoleTemplate personalizado para acesso mais avançado]

Você pode especificar qualquer combinação de recurso e verbo definida nas xref:/setup/security/rbac/rbac_permissions.adoc[permissões RBAC].  Observe que os traços (`-`) são retirados dos nomes dos recursos, de modo que a permissão `get-metric-bindings` se torna o recurso RBAC do Kubernetes `metricbindings` com o verbo `get`.


== Solução de problemas

* Verifique se o Rbac Agent do cluster consegue se comunicar com a plataforma.

* xref:/setup/security/rbac/rbac_permissions.adoc#_list_subjects_for_a_user[Inspecione os assuntos do usuário] (usuário e funções).
  ** Verifique qualquer configuração de função no provedor OIDC.
* xref:/setup/security/rbac/rbac_permissions.adoc#_show_granted_permissions[Inspecionar a permissão do assunto]
  ** Verifique se os (Cluster)RoleBindings relevantes que correspondem ao usuário com uma (Cluster)Role estão presentes.
  ** Inspecione a função (Cluster) para verificar se ela concede as permissões corretas.
