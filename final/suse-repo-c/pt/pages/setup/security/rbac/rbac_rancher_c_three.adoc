= Rancher RBAC
:revdate: 2025-07-10
:page-revdate: {revdate}
:description: SUSE Observability auto-hospedado

== Visão Geral

A extensão de Observabilidade SUSE Rancher Prime usa RBAC do Kubernetes para conceder acesso a usuários do Rancher na SUSE Observability.
Se você não usar o Rancher, veja xref:/setup/security/rbac/rbac_roles.adoc[Como configurar funções] em uma instalação autônoma.

[NOTE]
====
Para que o RBAC do Rancher funcione, 

* A autenticação para {stackstate-product-name} deve ser configurada com o xref:setup/security/authentication/oidc.adoc#_rancher[Provedor OIDC do Rancher].
* O agente {stackstate-product-name} deve ter o RBAC Agent habilitado e deve se autenticar usando um token de serviço.
====

Todo usuário autenticado tem o papel *Instance Basic Access* que permite usar o sistema.  Essas permissões fornecem acesso às visualizações, configurações, metric-bindings e permitem que o usuário veja as notificações do sistema.  Elas NÃO concedem acesso a nenhum dado {stackstate-product-name}.  Para ver qualquer dado, um usuário precisa receber um papel adicional. Duas opções para estender o papel *Instance Basic Access* são fornecidas com os *Role Templates* do Rancher:

Papéis de Instância:: Permite que você configure ou personalize {stackstate-product-name}.
Papéis com Escopo:: Concede acesso aos dados {stackstate-product-name} de clusters observados.

== Papéis de Instância

Você pode atribuir os *Modelos de Papel* de *Papéis de Instância* a usuários ou grupos no *Projeto* que está em execução {stackstate-product-name}. Se nenhum papel de instância for explicitamente atribuído a um membro de um projeto, então ele terá as permissões do papel *Instance Basic Access*.

=== Papéis de Instância com acesso a dados {stackstate-product-name}

Alguns papéis "globais" permitem acesso a todos os dados {stackstate-product-name} em qualquer um dos clusters observados.  Esses papéis destinam-se a serem usados para configurar o sistema e para solucionar problemas no nível do sistema.  Para usuários com qualquer um desses papéis, não é necessário configurar xref:scoped[Papéis com Escopo].

Administrador da Instância:: Concede acesso total a todas as visualizações e a todas as permissões.
Solucionador de problemas da instância:: Concede todas as permissões necessárias para usar o SUSE Observability para solucionar problemas, incluindo a capacidade de ativar / desativar monitores, criar visualizações personalizadas e usar a CLI.
Observador da Instância:: Concede acesso a todos os dados em uma instância do SUSE Observability.

=== Funções de instância sem acesso aos dados {stackstate-product-name}

Essas funções precisam ser combinadas com a função *Observador da Instância* ou uma das xref:scoped[Funções com Escopo] (veja abaixo).  Caso contrário, nenhum dado {stackstate-product-name} é acessível e a interface mostrará uma mensagem "Nenhum componente encontrado".  Isso se aplica a todos os usuários do Rancher, incluindo usuários, como proprietários de projetos.

Acesso Recomendado à Instância:: Concedem-se as permissões recomendadas para usar o SUSE Observability.  Esse papel inclui permissões que não são estritamente necessárias, mas fornece meios (limitados) de personalização {stackstate-product-name}.
Acesso Básico à Instância:: Concede permissões mínimas para o uso de {stackstate-product-name}. Esse papel não precisa ser atribuído explicitamente e não há *Modelo de Papel* para ele; todo usuário autenticado o possui. 

Você pode encontrar as permissões atribuídas a cada papel predefinido do SUSE Observability abaixo. Para obter detalhes sobre as diferentes permissões e como gerenciá-las usando o CLI `sts`, consulte xref:/setup/security/rbac/rbac_permissions.adoc[Permissões de controle de acesso baseado em papel (RBAC)]

[tabs]
====
Acesso Básico::
+
--
O acesso básico concede permissões mínimas para usar o SUSE Observability. Para ser combinado com um Observador (Instância, Cluster ou Projeto).
Essas permissões são concedidas a todos os usuários.

|===
|Resource |Verbos 

|metric-bindings |obter
|configurações |obter
|notificações do sistema |obter
|telas |obter
|===

--
Acesso Recomendado::
+
--
O acesso recomendado concede permissões que não são estritamente necessárias, mas que tornam o SUSE Observability muito mais útil. Ele fornece um grau limitado de personalização.
Para ser combinado com um Observador (Instância, Cluster ou Projeto).

|===
|Resource |Verbos 

|api-tokens |obter
|favorite-dashboards |criar, excluir
|visualizações favoritas |criar, excluir
|stackpacks |obter 
|configurações de visualização |atualizar
|===

--
Observador::
+
--
Observer concede acesso a todos os dados de observabilidade em uma instância do SUSE Observability.  Combine com *Acesso Recomendado* para uma melhor experiência.

|===
|Resource |Verbos 

|topologia |obter
|métricas |obter
|rastros |obter
|===

--
Solução de problemas::
+
--
O papel de Solucionador de Problemas tem acesso a todos os dados disponíveis no SUSE Observability e a capacidade de criar visões e habilitar/desabilitar monitores.

|===
|Resource |Verbos 

|agentes |obter 
|api-tokens |obter
|Ações do componente |executar
|painéis |obter, criar, atualizar, excluir 
|favorite-dashboards |criar, excluir
|visualizações favoritas |criar, excluir
|metric-bindings |obter
|métricas |obter 
|monitores |obter, criar, atualizar, excluir, executar 
|notificações |obter, criar, atualizar, excluir 
|configurações |obter 
|Configurações do StackPack |obter, criar, atualizar, excluir
|stackpacks |obter 
|notificações do sistema |obter
|topologia |obter 
|rastros |obter 
|telas |obter, criar, atualizar, excluir 
|configurações de visualização |obter
|===

--
Admin.::
+
--
O papel de Administrador tem todas as permissões atribuídas.

|===
|Resource |Verbos 

|agentes |obter 
|api-tokens |obter
|ações do componente |executar
|painéis |obter, criar, atualizar, excluir 
|favorite-dashboards |criar, excluir
|visualizações favoritas |criar, excluir
|chaves de API de ingestão |obter, criar, atualizar, excluir
|metric-bindings |obter
|métricas |obter 
|monitores |obter, criar, atualizar, excluir, executar 
|notificações |obter, criar, atualizar, excluir 
|permissions |obter, criar, atualizar, excluir 
|scripts restritos |executar
|service-tokens |obter, criar, atualizar, excluir
|configurações |obter, criar, atualizar, excluir, desbloquear 
|configurações do stackpack |obter, criar, atualizar, excluir
|stackpacks |obter, criar 
|sync-data |obter, atualizar, excluir
|notificações do sistema |obter
|mensagens do tópico |obter
|topologia |obter 
|rastros |obter 
|telas |obter, criar, atualizar, excluir 
|configurações de visualização |atualizar
|===

--
====

[#scoped]
== Papéis com escopo

Você pode atribuir os seguintes *Modelos de Papéis* a usuários ou grupos em um cluster observado.  Eles concedem acesso a {stackstate-product-name} dados provenientes de (um *Projeto* no *Cluster*), dando ao usuário permissão para ler topologia, métricas, logs e dados de rastreamento.

Observador:: Concede acesso a dados provenientes de namespaces em um *Projeto*. Você pode usar isso na seção *Membros do Projeto* da configuração do cluster.
Observador do Cluster:: Concede acesso a todos os dados provenientes de um *Cluster*. Você pode usar este modelo na seção *Associação ao Cluster* da configuração do cluster.

Os recursos nesses papéis correspondem a xref:/setup/security/rbac/rbac_permissions.adoc#_scoped_permissions[Permissões com escopo]. Eles estão disponíveis no grupo de API `scope.observability.cattle.io` (apenas com o verbo `get` já que esses recursos são somente leitura) :

* `topology` - componentes (implantações, pods, etcetera) do cluster ou namespace
* `traces` - spans de cluster ou namespace
* `metrics` - dados de métricas provenientes do cluster ou namespace

Observe que o acesso aos logs é controlado pelo `topology` recurso.

Ative a personalização para usuários com esses papéis de observador concedendo o papel *Acesso Recomendado da Instância* no *Projeto* que está executando {stackstate-product-name}.

== Papéis Personalizados

Para conceder permissões adicionais além do Acesso Recomendado, crie um *Modelo de Papel* de projeto personalizado no Rancher, herdando de *Acesso Recomendado da Instância de Observabilidade SUSE*.  Então, por exemplo, para conceder os direitos de visualizar monitores e gráficos de métricas, adicione regras com :

* Verbo: `get`
* Recurso: `metricbindings` e `monitors`
* ApiGroup: `instance.observability.cattle.io`

image::rancher-custom-role.png[Modelo de Papel Personalizado para acesso aprimorado]

Você pode especificar qualquer combinação de recurso e verbo definida nas xref:/setup/security/rbac/rbac_permissions.adoc[Permissões RBAC].  Observe que os traços (`-`) são removidos dos nomes dos recursos, então a permissão `get-metric-bindings` se torna o recurso RBAC do Kubernetes `metricbindings` com o verbo `get`.


== Solução de problemas

* Verifique se o Agente RBAC para o cluster consegue se comunicar com a plataforma.

* xref:/setup/security/rbac/rbac_permissions.adoc#_list_subjects_for_a_user[Inspecione os usuários] (usuários e papéis).
  ** Verifique qualquer configuração de papéis no provedor OIDC.
* xref:/setup/security/rbac/rbac_permissions.adoc#_show_granted_permissions[Inspecione a permissão do usuário]
  ** Verifique se os (Cluster)RoleBindings relevantes que associam o usuário a um (Cluster)Papel estão presentes.
  ** Inspecione o (Cluster)Papel para verificar se ele concede as permissões corretas.
