= Rancher RBAC
:revdate: 2025-07-10
:page-revdate: {revdate}
:description: SUSE Observability Self-hosted

== Présentation

L'extension SUSE Rancher Prime Observability utilise Kubernetes RBAC pour accorder l'accès aux utilisateurs de Rancher dans SUSE Observability.
Si vous n'utilisez pas Rancher, consultez xref:/setup/security/rbac/rbac_roles.adoc[Comment configurer des rôles] dans une installation autonome.

[NOTE]
====
Pour que Rancher RBAC fonctionne, 

* L'authentification pour {stackstate-product-name} doit être configurée avec le xref:setup/security/authentication/oidc.adoc#_rancher[fournisseur OIDC Rancher].
* L’agent {stackstate-product-name} doit avoir le RBAC Agent activé et doit s’authentifier à l’aide d’un jeton de service.
====

Chaque utilisateur authentifié a le rôle *Accès de base à l'instance*\&nbsp;qui lui permet d'utiliser le système.  Ces autorisations donnent accès aux vues, paramètres, liaisons de métriques et permettent à un utilisateur de voir les notifications système.  Elles ne donnent PAS accès à aucune donnée {stackstate-product-name}.  Pour voir des données, un utilisateur doit se voir attribuer un rôle supplémentaire. Deux directions pour étendre le rôle *Accès de base à l'instance* sont fournies avec Rancher *Modèles de rôle* :

Rôles d'instance:: Vous permet de configurer ou de personnaliser {stackstate-product-name}.
Rôles à portée limitée:: Accorde l'accès aux données {stackstate-product-name} des clusters observés.

== Rôles d'instance

Vous pouvez attribuer les *Modèles de rôle* pour *Rôles d'instance* aux utilisateurs ou groupes du *Projet* qui exécute {stackstate-product-name}. Si aucun rôle d'instance n'est explicitement attribué à un membre d'un projet, alors ce membre aura les autorisations du rôle *Accès de base à l'instance*.

=== Rôles d'instance avec accès aux données {stackstate-product-name}

Quelques rôles « globaux » permettent d'accéder à toutes les données {stackstate-product-name} dans n'importe lequel des clusters observés.  Ces rôles sont destinés à être utilisés pour configurer le système et pour résoudre des problèmes au niveau du système.  Pour les utilisateurs ayant l’un de ces rôles, il n’est pas nécessaire de configurer les xref:scoped[Rôles à portée limitée].

Administrateur d'instance:: Accorde un accès complet à toutes les vues et à toutes les autorisations.
Dépanneur d’instance:: Accorde toutes les autorisations nécessaires pour utiliser SUSE Observability pour le dépannage, y compris la possibilité d'activer/désactiver des moniteurs, de créer des vues personnalisées et d'utiliser la CLI.
Observateur d'instance:: Accorde l’accès à toutes les données dans une instance SUSE Observability.

=== Rôles d'instance sans accès aux données de {stackstate-product-name}

Ces rôles doivent être combinés avec le rôle *Observateur d'instance* ou l'un des xref:scoped[rôles à portée] (voir ci-dessous).  Sinon, aucune donnée {stackstate-product-name} n'est accessible et l'interface utilisateur affichera un message "Aucun composant trouvéS".  Cela s'applique à tous les utilisateurs de Rancher, y compris les propriétaires de projet.

Accès recommandé pour l'instance:: Accorde les autorisations recommandées pour utiliser SUSE Observability.  Ce rôle inclut des autorisations qui ne sont pas strictement nécessaires, mais qui offrent des moyens (limités) de personnalisation {stackstate-product-name}.
Accès de base à l'instance:: Accorde des autorisations minimales pour utiliser {stackstate-product-name}. Ce rôle n'a pas besoin d'être explicitement attribué et il n'y a pas de *Modèle de rôle* pour cela; chaque utilisateur connecté l'a. 

Vous pouvez trouver les autorisations attribuées à chaque rôle prédéfini de SUSE Observability ci-dessous. Pour plus de détails sur les différentes autorisations et sur la façon de les gérer à l'aide du `sts` CLI, consultez xref:/setup/security/rbac/rbac_permissions.adoc[Autorisations du contrôle d'accès basé sur les rôles (RBAC)]

[tabs]
====
Accès de base::
+
--
L'accès de base accorde des autorisations minimales pour utiliser SUSE Observability. À combiner avec un observateur (instance, cluster ou projet).
Ces autorisations sont accordées à tous les utilisateurs.

|===
|Ressource |Verbes 

|liaisons de métriques |obtenir
|paramètres |obtenir
|system-notifications |obtenir
|vues |obtenir
|===

--
Accès recommandé::
+
--
L'accès recommandé accorde des autorisations qui ne sont pas strictement nécessaires, mais qui rendent SUSE Observability beaucoup plus utile. Il offre un degré limité de personnalisation.
À combiner avec un observateur (instance, cluster ou projet).

|===
|Ressource |Verbes 

|api-tokens |obtenir
|tableaux de bord favoris |créer, supprimer
|Vues favorites |créer, supprimer
|stackpacks |obtenir 
|paramètres de visualisation |update
|===

--
Observer::
+
--
L'Observateur accorde l'accès à toutes les données d'observabilité dans une instance de SUSE Observability.  Combiner avec *Accès recommandé* pour une meilleure expérience .

|===
|Ressource |Verbes 

|topologie |obtenir
|métriques |obtenir
|traces |obtenir
|===

--
Assistant de dépannage::
+
--
Le rôle de dépanneur a accès à toutes les données disponibles dans SUSE Observability et la capacité de créer des vues et d’activer / désactiver des moniteurs.

|===
|Ressource |Verbes 

|agents |obtenir 
|api-tokens |obtenir
|actions du composant |execute
|tableaux de bord |obtenir, créer, mettre à jour, supprimer 
|tableaux de bord favoris |créer, supprimer
|Vues favorites |créer, supprimer
|liaisons de métriques |obtenir
|métriques |obtenir 
|moniteurs |obtenir, créer, mettre à jour, supprimer, exécuter 
|notifications |obtenir, créer, mettre à jour, supprimer 
|paramètres |obtenir 
|stackpack-configurations |obtenir, créer, mettre à jour, supprimer
|stackpacks |obtenir 
|system-notifications |obtenir
|topologie |obtenir 
|traces |obtenir 
|vues |obtenir, créer, mettre à jour, supprimer 
|paramètres de visualisation |obtenir
|===

--
Admin::
+
--
Le rôle d'administrateur a tous les droits assignés.

|===
|Ressource |Verbes 

|agents |obtenir 
|api-tokens |obtenir
|actions du composant |execute
|tableaux de bord |obtenir, créer, mettre à jour, supprimer 
|tableaux de bord favoris |créer, supprimer
|Vues favorites |créer, supprimer
|clés API d'ingestion |obtenir, créer, mettre à jour, supprimer
|liaisons de métriques |obtenir
|métriques |obtenir 
|moniteurs |obtenir, créer, mettre à jour, supprimer, exécuter 
|notifications |obtenir, créer, mettre à jour, supprimer 
|permissions |obtenir, créer, mettre à jour, supprimer 
|scripts restreints |execute
|jetons-de-service |obtenir, créer, mettre à jour, supprimer
|paramètres |récupérer, créer, mettre à jour, supprimer, déverrouiller 
|stackpack-configurations |obtenir, créer, mettre à jour, supprimer
|stackpacks |récupérer, créer 
|sync-data |obtenir, mettre à jour, supprimer
|system-notifications |obtenir
|messages du sujet |obtenir
|topologie |obtenir 
|traces |obtenir 
|vues |obtenir, créer, mettre à jour, supprimer 
|paramètres de visualisation |update
|===

--
====

[#scoped]
== Rôles à portée limitée

Vous pouvez attribuer les *Modèles de rôle* suivants aux utilisateurs ou groupes dans un cluster observé.  Ils accordent l'accès aux données {stackstate-product-name} provenant d'un *Projet* dans le *Cluster*, donnant à un utilisateur l'autorisation de lire la topologie, les métriques, les journaux et les données de trace.

Observer:: Accorde l'accès aux données provenant des espaces de noms dans un *Projet*. Vous pouvez utiliser cela dans la section *Adhésion au projet* de la configuration du cluster.
Observateur de cluster:: Accorde l’accès à toutes les données provenant d’un *Cluster*. Vous pouvez utiliser ce modèle dans la section *Appartenance au cluster* de la configuration du cluster.

Les ressources dans ces rôles correspondent aux xref:/setup/security/rbac/rbac_permissions.adoc#_scoped_permissions[autorisations à portée limitée]. Elles sont disponibles dans le groupe API `scope.observability.cattle.io` (avec juste le verbe `get` car ces ressources sont en lecture seule) :

* `topology` - composants (déploiements, pods, etc. ) du cluster ou de l’espace de noms
* `traces` - plages du cluster ou de l'espace de noms
* `metrics` - données métriques provenant du cluster ou de l’espace de noms

Notez que l'accès aux journaux est contrôlé par la ressource `topology`.

Activez la personnalisation pour les utilisateurs avec ces rôles d'observateur en accordant le rôle *Accès recommandé pour l'instance* sur le *Projet* en cours d'exécution {stackstate-product-name}.

== Rôles personnalisés

Pour accorder des permissions supplémentaires au-delà de l'Accès Recommandé, créez un *RoleTemplate* de projet personnalisé dans Rancher, en héritant de *SUSE Observability Instance Recommended Access*.  Ensuite, par exemple, pour accorder les droits de consulter les moniteurs et les graphiques de métriques, ajoutez des règles avec :

* Verbe : `get`
* Ressource : `metricbindings` et `monitors`
* Groupe API : `instance.observability.cattle.io`

image::rancher-custom-role.png[Modèle de rôle personnalisé pour un accès plus riche]

Vous pouvez spécifier n'importe quelle combinaison de ressource et de verbe définie dans les xref:/setup/security/rbac/rbac_permissions.adoc[Permissions\&nbsp;RBAC].  Notez que les tirets (`-`) sont supprimés des noms de ressources, donc l'autorisation `get-metric-bindings` devient la ressource RBAC Kubernetes `metricbindings` avec le verbe `get`.


== Dépannage

* Vérifiez que l'agent RBAC pour le cluster est capable de communiquer avec la plateforme.

* xref:/setup/security/rbac/rbac_permissions.adoc#_list_subjects_for_a_user[Inspectez les utilisateurs] (utilisateurs et rôles).
  ** Vérifiez toute configuration de rôles sur le fournisseur OIDC.
* xref:/setup/security/rbac/rbac_permissions.adoc#_show_granted_permissions[Inspectez l'autorisation du sujet]
  ** Vérifiez que les (Cluster)RoleBindings pertinents qui associent l'utilisateur à un (Cluster)Role sont présents.
  ** Inspectez le (Cluster)Role pour vérifier qu'il accorde les bonnes autorisations.
