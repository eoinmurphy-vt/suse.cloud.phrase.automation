= Rancher RBAC
:revdate: 2025-07-10
:page-revdate: {revdate}
:description: SUSE Observability Autogestionado

== Descripción general

La extensión de observabilidad de SUSE Rancher Prime utiliza Kubernetes RBAC para otorgar acceso a los usuarios de Rancher en SUSE Observability.
Si no utilizas Rancher, consulta xref:/setup/security/rbac/rbac_roles.adoc[Cómo configurar roles] en una instalación independiente.

[NOTE]
====
Para que Rancher RBAC funcione, 

* La autenticación para {stackstate-product-name} debe configurarse con el xref:setup/security/authentication/oidc.adoc#_rancher[Proveedor OIDC de Rancher].
* El {stackstate-product-name} Agente debe tener habilitado el Agente RBAC y debe autenticarse utilizando un token de servicio.
====

Cada usuario autenticado tiene el rol de *Acceso Básico a la Instancia* que le permite utilizar el sistema.  Estos permisos proporcionan acceso a las vistas, ajustes, enlaces de métricas y permiten que un usuario vea notificaciones del sistema.  NO otorgan acceso a ningún dato de {stackstate-product-name}.  Para que un usuario pueda ver cualquier dato, debe recibir un rol adicional. Se proporcionan dos formas de extender el rol de *Acceso Básico a la Instancia* con las *Plantillas de Roles* de Rancher:

Roles de Instancia:: Te permite configurar o personalizar {stackstate-product-name}.
Roles con alcance:: Otorga acceso a los datos de {stackstate-product-name} de los clústeres observados.

== Roles de Instancia

Puedes asignar las *Plantillas de Roles* para *Roles de Instancia* a usuarios o grupos en el *Proyecto* que está ejecutando {stackstate-product-name}. Si no se asignan roles de instancia explícitamente a un miembro de un proyecto, entonces tendrá los permisos del rol *Acceso básico a la instancia*.

=== Roles de Instancia con acceso a los datos de {stackstate-product-name}

Un par de roles "globales" permiten el acceso a todos los datos de {stackstate-product-name} en cualquiera de los clústeres observados.  Estos roles están destinados a ser utilizados para configurar el sistema y para solucionar problemas a nivel de sistema.  Para los usuarios con cualquiera de estos roles, no es necesario configurar xref:scoped[Roles con alcance].

Administrador de Instancia:: Otorga acceso completo a todas las vistas y a todos los permisos.
Solucionador de problemas de instancia:: Otorga todos los permisos necesarios para utilizar SUSE Observability para la solución de problemas, incluyendo la capacidad de habilitar/deshabilitar monitores, crear vistas personalizadas y utilizar la CLI.
Observador de Instancia:: Otorga acceso a todos los datos en una instancia de SUSE Observability.

=== Roles de instancia sin acceso a los datos de {stackstate-product-name}

Estos roles necesitan combinarse con el rol *Observador de Instancia* o uno de los xref:scoped[roles con alcance] (ver más abajo).  De lo contrario, no hay datos {stackstate-product-name} accesibles y la interfaz mostrará un mensaje de "No se encontraron componentes".  Esto se aplica a todos los usuarios de Rancher, incluidos los propietarios de proyectos.

Acceso recomendado de instancia:: Otorga permisos recomendados para utilizar SUSE Observability.  Este rol incluye permisos que no son estrictamente necesarios, pero proporcionan unos medios (limitados) de personalización {stackstate-product-name}.
Acceso básico de instancia:: Otorga permisos mínimos para utilizar {stackstate-product-name}. Este rol no necesita ser asignado explícitamente y no hay *Plantilla de rol* para este rol; cada usuario que haya iniciado sesión lo tiene. 

Puedes encontrar los permisos asignados a cada rol predefinido de SUSE Observability a continuación. Para obtener detalles sobre los diferentes permisos y cómo gestionarlos utilizando el CLI `sts`, consulta xref:/setup/security/rbac/rbac_permissions.adoc[Permisos de control de acceso basado en roles (RBAC)]

[tabs]
====
Acceso básico::
+
--
El acceso básico otorga permisos mínimos para utilizar SUSE Observability. Para combinarse con un observador (instancia, clúster o proyecto).
Estos permisos se otorgan a todos los usuarios.

|===
|Recurso |Detalles 

|vinculaciones métricas |obtener
|ajustes |obtener
|notificaciones del sistema |obtener
|vistas |obtener
|===

--
Acceso recomendado::
+
--
El acceso recomendado otorga permisos que no son estrictamente necesarios, pero que hacen que SUSE Observability sea mucho más útil. Proporciona un grado limitado de personalización.
Para combinarse con un observador (instancia, clúster o proyecto).

|===
|Recurso |Detalles 

|api-tokens |obtener
|favorite-dashboards |crear, eliminar
|favorite-views |crear, eliminar
|paquetes de pila |obtener 
|Ajustes de visualización |update
|===

--
Observador::
+
--
El observador otorga acceso a todos los datos de observabilidad en una instancia de SUSE Observability.  Combina con *Acceso recomendado* para una mejor experiencia.

|===
|Recurso |Detalles 

|topología |obtener
|métricas |obtener
|trazas |obtener
|===

--
Solucionador de problemas::
+
--
El rol de Solucionador de problemas tiene acceso a todos los datos disponibles en SUSE Observability y la capacidad de crear vistas y habilitar/deshabilitar monitores.

|===
|Recurso |Detalles 

|agentes |obtener 
|api-tokens |obtener
|acciones de componente |ejecutar
|paneles de control |obtener, crear, actualizar, eliminar 
|favorite-dashboards |crear, eliminar
|favorite-views |crear, eliminar
|vinculaciones métricas |obtener
|métricas |obtener 
|monitores |obtener, crear, actualizar, eliminar, ejecutar 
|notificaciones |obtener, crear, actualizar, eliminar 
|ajustes |obtener 
|Configuraciones de paquetes de pila |obtener, crear, actualizar, eliminar
|paquetes de pila |obtener 
|notificaciones del sistema |obtener
|topología |obtener 
|trazas |obtener 
|vistas |obtener, crear, actualizar, eliminar 
|Ajustes de visualización |obtener
|===

--
Admin.::
+
--
El rol de Administrador tiene todos los permisos asignados.

|===
|Recurso |Detalles 

|agentes |obtener 
|api-tokens |obtener
|acciones de componente |ejecutar
|paneles de control |obtener, crear, actualizar, eliminar 
|favorite-dashboards |crear, eliminar
|favorite-views |crear, eliminar
|claves de API de ingesta |obtener, crear, actualizar, eliminar
|vinculaciones métricas |obtener
|métricas |obtener 
|monitores |obtener, crear, actualizar, eliminar, ejecutar 
|notificaciones |obtener, crear, actualizar, eliminar 
|permissions |obtener, crear, actualizar, eliminar 
|scripts restringidos |ejecutar
|service-tokens |obtener, crear, actualizar, eliminar
|ajustes |obtener, crear, actualizar, eliminar, desbloquear 
|configuraciones de paquetes de pila |obtener, crear, actualizar, eliminar
|paquetes de pila |obtener, crear 
|sync-data |obtener, actualizar, eliminar
|notificaciones del sistema |obtener
|mensajes de tema |obtener
|topología |obtener 
|trazas |obtener 
|vistas |obtener, crear, actualizar, eliminar 
|Ajustes de visualización |update
|===

--
====

[#scoped]
== Roles con alcance

Puedes asignar las siguientes *Plantillas de rol* a usuarios o grupos en un clúster observado.  Conceden acceso a {stackstate-product-name} datos provenientes de (un *Proyecto* en) el *Cluster*, dando a un usuario permiso para leer topología, métricas, registros y datos de trazas.

Observador:: Concede acceso a datos provenientes de espacios de nombres en un *Proyecto*. Puedes usar esto en la sección *Membresía del proyecto* de la configuración del clúster.
Observador del clúster:: Concede acceso a todos los datos provenientes de un *Cluster*. Puedes usar esta plantilla en la sección *Membresía del Clúster* de la configuración del clúster.

Los recursos en estos roles corresponden a xref:/setup/security/rbac/rbac_permissions.adoc#_scoped_permissions[Permisos con alcance]. Están disponibles en el grupo de API `scope.observability.cattle.io` (con solo el verbo `get` ya que estos recursos son de solo lectura):

* `topology` - componentes (despliegues, pods, etcétera) del clúster o espacio de nombres
* `traces` - spans del clúster o del espacio de nombres
* `metrics` - datos métricos originados en el clúster o espacio de nombres

Ten en cuenta que el acceso a los registros está controlado por el `topology` recurso.

Habilita la personalización para usuarios con estos roles de observador concediendo el rol *Acceso Recomendado de Instancia* en el *Proyecto* que está ejecutando {stackstate-product-name}.

== Roles personalizados

Para conceder permisos adicionales además del Acceso recomendado, crea una *Plantilla de Rol* de proyecto personalizada en Rancher, heredando de *Acceso recomendado para la instancia de SUSE Observability*.  Luego, por ejemplo, para conceder los derechos para ver monitores y gráficos métricos, añade reglas con:

* Verbo: `get`
* Recurso: `metricbindings` y `monitors`
* ApiGroup: `instance.observability.cattle.io`

image::rancher-custom-role.png[Plantilla de rol personalizada para un acceso más completo]

Puedes especificar cualquier combinación de recurso y verbo definida en los xref:/setup/security/rbac/rbac_permissions.adoc[Permisos RBAC].  Ten en cuenta que los guiones (`-`) se eliminan de los nombres de los recursos, por lo que el permiso `get-metric-bindings` se convierte en el recurso RBAC de Kubernetes `metricbindings` con el verbo `get`.


== Solución de problemas

* Verifica que el Agente RBAC para el clúster pueda comunicarse con la plataforma.

* xref:/setup/security/rbac/rbac_permissions.adoc#_list_subjects_for_a_user[Inspeccionar los sujetos de usuario] (usuario y roles).
  ** Verifica la configuración de roles en el proveedor OIDC.
* xref:/setup/security/rbac/rbac_permissions.adoc#_show_granted_permissions[Inspeccionar el permiso del sujeto]
  ** Verifica que los (Cluster)RoleBindings relevantes que emparejan al usuario con un (Cluster)Role estén presentes.
  ** Inspecciona el (Cluster)Role para verificar que otorga permisos correctos.
