= Rancher RBAC
:revdate: 2025-07-10
:page-revdate: {revdate}
:description: SUSE Observability autoalojado

== Visión general

SUSE Rancher Prime Observability Extension utiliza Kubernetes RBAC para conceder acceso a los usuarios de Rancher en SUSE Observability.
Si no utiliza Rancher, consulte xref:/setup/security/rbac/rbac_roles.adoc[Cómo configurar roles] en una instalación autónoma.

[NOTE]
====
Para que Rancher RBAC funcione, 

* La autenticación para {stackstate-product-name} debe ser configurada con el xref:setup/security/authentication/oidc.adoc#_rancher[Rancher OIDC Provider].
* el Agente {stackstate-product-name} debe tener activado el Agente RBAC y debe autenticarse utilizando un token de servicio.
====

Cada usuario autenticado tiene el rol *Instancia Acceso Básico* que le permite utilizar el sistema.  Estos permisos proporcionan acceso a las vistas, los ajustes, los enlaces métricos y permiten al usuario ver las notificaciones del sistema.  NO dan acceso a ningún dato de {stackstate-product-name}.  Para poder ver cualquier dato, un usuario necesita que se le asigne un rol adicional. Se proporcionan dos direcciones para ampliar el rol de *Acceso Básico a Instancia* con *las Plantillas de Rol* de Rancher:

Funciones de instancia:: Permite configurar o personalizar {stackstate-product-name}.
Funciones ampliadas:: Permite acceder a los datos {stackstate-product-name} de los cúmulos observados.

== Funciones de instancia

Puede asignar las *Plantillas de Rol* para *Roles de Instancia* a usuarios o grupos en el *Proyecto* que está ejecutando {stackstate-product-name}. Si no se asigna explícitamente ningún rol de instancia a un miembro de un proyecto, éste tendrá los permisos del rol *Acceso Básico a Instancia*.

=== Roles de instancia con acceso a los datos de {stackstate-product-name} 

Un par de roles "globales" permiten acceder a todos los datos de {stackstate-product-name} - en cualquiera de los clusters observados.  Estos roles están pensados para ser utilizados en la configuración del sistema y en la resolución de problemas a nivel de sistema.  Para los usuarios con cualquiera de estos roles, no es necesario configurar xref:scoped[Scoped Roles].

Administrador de instancias:: Concede acceso completo a todas las vistas y a todos los permisos.
Solucionador de problemas de instancias:: Concede todos los permisos necesarios para utilizar SUSE Observability para la resolución de problemas, incluida la capacidad de activar/desactivar monitores, crear vistas personalizadas y utilizar la CLI.
Observador de instancias:: Concede acceso a todos los datos de una instancia de SUSE Observability.

=== Funciones de instancia sin acceso a los datos de {stackstate-product-name} 

Estos roles deben combinarse con el rol *Observador de Instancia* o con uno de los xref:scoped[Roles de Alcance] (ver más abajo).  De lo contrario, no se podrá acceder a los datos de {stackstate-product-name} y la interfaz de usuario mostrará el mensaje "No se han encontrado componentes".  Esto se aplica a todos los usuarios de Rancher, incluidos los usuarios, como los propietarios de proyectos.

Instancia Acceso recomendado:: Concede los permisos recomendados para utilizar SUSE Observability.  Este rol incluye permisos que no son estrictamente necesarios, pero proporcionan medios (limitados) de personalización {stackstate-product-name}.
Instancia Acceso básico:: Concede permisos mínimos para utilizar {stackstate-product-name}. Este rol no necesita ser asignado explícitamente y no existe una *Plantilla de Rol* para él; todos los usuarios conectados lo tienen. 

A continuación encontrará los permisos asignados a cada función predefinida de SUSE Observability. Para obtener más información sobre los distintos permisos y cómo gestionarlos mediante la CLI de `sts`, consulte xref:/setup/security/rbac/rbac_permissions.adoc[Permisos de control de acceso basado en funciones (RBAC)].

[tabs]
====
Acceso básico::
+
--
El acceso básico concede permisos mínimos para utilizar SUSE Observability. Para combinar con un Observador (Instancia, Cluster o Proyecto).
Estos permisos se conceden a todos los usuarios.

|===
|Recursos |Verbos 

|enlaces métricos |consiga
|ajustes |consiga
|sistema-notificaciones |consiga
|vistas |consiga
|===

--
Acceso recomendado::
+
--
El acceso recomendado concede permisos que no son estrictamente necesarios, pero que hacen que SUSE Observability sea mucho más útil. Ofrece un grado limitado de personalización.
Para combinar con un Observador (Instancia, Cluster o Proyecto).

|===
|Recursos |Verbos 

|api-tokens |consiga
|favorite-dashboards |crear, eliminar
|favorite-views |crear, eliminar
|mochilas |consiga 
|configuración-visualización |actualización
|===

--
Observador::
+
--
Observer permite acceder a todos los datos de observabilidad de una instancia de SUSE Observability.  Combínalo con *Acceso recomendado* para disfrutar de una mejor experiencia.

|===
|Recursos |Verbos 

|topología |consiga
|métricas |consiga
|rastros |consiga
|===

--
Solucionador de problemas::
+
--
La función de solucionador de problemas tiene acceso a todos los datos disponibles en SUSE Observability y la capacidad de crear vistas y activar/desactivar monitores.

|===
|Recursos |Verbos 

|agentes |consiga 
|api-tokens |consiga
|componente-acciones |ejecutar
|cuadros de mando |obtener, crear, actualizar, eliminar 
|favorite-dashboards |crear, eliminar
|favorite-views |crear, eliminar
|enlaces métricos |consiga
|métricas |consiga 
|monitores |obtener, crear, actualizar, eliminar, ejecutar 
|notificaciones |obtener, crear, actualizar, eliminar 
|ajustes |consiga 
|stackpack-configurations |obtener, crear, actualizar, eliminar
|mochilas |consiga 
|sistema-notificaciones |consiga
|topología |consiga 
|rastros |consiga 
|vistas |obtener, crear, actualizar, eliminar 
|configuración-visualización |consiga
|===

--
Admin::
+
--
El rol de Administrador tiene todos los permisos asignados.

|===
|Recursos |Verbos 

|agentes |consiga 
|api-tokens |consiga
|componente-acciones |ejecutar
|cuadros de mando |obtener, crear, actualizar, eliminar 
|favorite-dashboards |crear, eliminar
|favorite-views |crear, eliminar
|ingestion-api-keys |obtener, crear, actualizar, eliminar
|enlaces métricos |consiga
|métricas |consiga 
|monitores |obtener, crear, actualizar, eliminar, ejecutar 
|notificaciones |obtener, crear, actualizar, eliminar 
|permisos |obtener, crear, actualizar, eliminar 
|guiones restringidos |ejecutar
|service-tokens |obtener, crear, actualizar, eliminar
|ajustes |obtener, crear, actualizar, eliminar, desbloquear 
|stackpack-configurations |obtener, crear, actualizar, eliminar
|mochilas |obtener, crear 
|sync-data |obtener, actualizar, eliminar
|sistema-notificaciones |consiga
|mensajes-tema |consiga
|topología |consiga 
|rastros |consiga 
|vistas |obtener, crear, actualizar, eliminar 
|configuración-visualización |actualización
|===

--
====

[#scoped]
== Funciones delimitadas

Puede asignar las siguientes *plantillas de funciones* a los usuarios o grupos de un clúster observado.  Conceden acceso a {stackstate-product-name} datos procedentes de (un *Proyecto* en) el *Cluster*, dando permiso a un usuario para leer topología, métricas, logs y datos de trazas.

Observador:: Permite acceder a los datos procedentes de los espacios de nombres de un *proyecto*. Puede utilizarlo en la sección *"Project Membership"* de la configuración del clúster.
Observador de grupos:: Da acceso a todos los datos procedentes de un *Cluster*. Puede utilizar esta plantilla en la sección *Membresía del* clúster de la configuración del clúster.

Los recursos de estos roles corresponden a xref:/setup/security/rbac/rbac_permissions.adoc#_scoped_permissions[Permisos de Alcance]. Están disponibles en el grupo de API `scope.observability.cattle.io` (sólo con el verbo `get`, ya que estos recursos son de sólo lectura):

* `topology` - componentes (despliegues, pods, etcétera) del clúster o espacio de nombres
* `traces` - abarca desde el clúster o el espacio de nombres
* `metrics` - datos métricos procedentes del clúster o del espacio de nombres

Tenga en cuenta que el acceso a los registros está controlado por el recurso `topology`.

Habilite la personalización para usuarios con estos roles de observador otorgando el rol de *Acceso Recomendado a Instancia* en el *Proyecto* que ejecuta {stackstate-product-name}.

== Funciones personalizadas

Para conceder permisos adicionales más allá del acceso recomendado, cree una *plantilla de función de* proyecto personalizada en Rancher que herede el *acceso recomendado de la instancia de SUSE Observability*.  A continuación, por ejemplo, para conceder los derechos de visualización de monitores y gráficos de métricas, añada reglas con:

* Verbo: `get`
* Recurso: `metricbindings` y `monitors`
* ApiGroup: `instance.observability.cattle.io`

image::rancher-custom-role.png[RoleTemplate personalizado para un acceso más rico]

Puede especificar cualquier combinación de recurso y verbo definida en los xref:/setup/security/rbac/rbac_permissions.adoc[Permisos RBAC].  Tenga en cuenta que los guiones (`-`) se eliminan de los nombres de recursos, por lo que el permiso `get-metric-bindings` se convierte en el recurso RBAC de Kubernetes `metricbindings` con el verbo `get`.


== Solución de problemas

* Verificar que el Agente Rbac para el cluster es capaz de comunicarse con la plataforma.

* xref:/setup/security/rbac/rbac_permissions.adoc#_list_subjects_for_a_user[Inspeccione los temas de usuario] (usuario y roles).
  ** Verifique cualquier configuración de roles en el proveedor OIDC.
* xref:/setup/security/rbac/rbac_permissions.adoc#_show_granted_permissions[Inspeccionar el permiso sujeto]
  ** Compruebe que están presentes los (Cluster)RoleBindings correspondientes que corresponden al usuario con un (Cluster)Role.
  ** Inspeccione el (Cluster)Role para verificar que otorga los permisos correctos.
