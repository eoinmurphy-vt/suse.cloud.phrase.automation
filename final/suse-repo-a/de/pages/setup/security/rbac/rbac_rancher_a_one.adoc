= Rancher RBAC
:revdate: 2025-07-10
:page-revdate: {revdate}
:description: SUSE Observability Selbstgehostet

== Übersicht

Die SUSE Rancher Prime Observability Extension verwendet Kubernetes RBAC, um Rancher-Benutzern in SUSE Observability Zugriff zu gewähren.
Wenn Sie Rancher nicht verwenden, lesen Sie den Abschnitt xref:/setup/security/rbac/rbac_roles.adoc[Wie man Rollen] in einer eigenständigen Installation einrichtet.

[NOTE]
====
Damit Rancher RBAC funktioniert, 

* Die Authentifizierung für {stackstate-product-name} muss mit dem xref:setup/security/authentication/oidc.adoc#_rancher[Rancher OIDC Provider] konfiguriert werden.
* Der {stackstate-product-name} Agent muss den RBAC Agent aktiviert haben und sich mit einem Service-Token authentifizieren.
====

Jeder authentifizierte Benutzer hat die Rolle *Instance Basic Access*, die ihm die Nutzung des Systems ermöglicht.  Diese Berechtigungen ermöglichen den Zugriff auf die Ansichten, Einstellungen und metrischen Bindungen sowie die Anzeige von Systembenachrichtigungen.  Sie gewähren KEINEN Zugang zu den Daten von {stackstate-product-name}.  Um Daten einsehen zu können, muss einem Benutzer eine zusätzliche Rolle zugewiesen werden. Die *Rancher-Rollenvorlagen* bieten zwei Möglichkeiten zur Erweiterung der Rolle *Instance Basic Access*:

Instanz-Rollen:: Ermöglicht es Ihnen, {stackstate-product-name} zu konfigurieren oder zu personalisieren.
Umfassende Rollen:: Ermöglicht den Zugang zu {stackstate-product-name} Daten von beobachteten Clustern.

== Instanzrollen

Sie können die *Rollenvorlagen* für *Instanzrollen* Benutzern oder Gruppen in dem *Projekt* zuweisen, in dem {stackstate-product-name} ausgeführt wird. Wenn einem Mitglied eines Projekts keine Instanzrollen explizit zugewiesen sind, hat es die Berechtigungen der Rolle *Instance Basic Access*.

=== Instanzrollen mit Zugriff auf {stackstate-product-name} Daten

Einige "globale" Rollen ermöglichen den Zugriff auf alle {stackstate-product-name} Daten - in jedem der beobachteten Cluster.  Diese Rollen sind für die Einrichtung des Systems und für die Behebung von Problemen auf Systemebene vorgesehen.  Für Benutzer mit einer dieser Rollen ist es nicht erforderlich, xref:scoped["Scoped Roles"] zu konfigurieren.

Instanz Admin:: Gewährt vollen Zugriff auf alle Ansichten und alle Berechtigungen.
Instanz-Fehlerbehebung:: Gewährt alle Berechtigungen, die für die Verwendung von SUSE Observability zur Fehlerbehebung erforderlich sind, einschließlich der Möglichkeit, Monitore zu aktivieren/deaktivieren, benutzerdefinierte Ansichten zu erstellen und die CLI zu verwenden.
Instanz Beobachter:: Ermöglicht den Zugriff auf alle Daten in einer SUSE Observability-Instanz.

=== Instanzrollen ohne Zugriff auf {stackstate-product-name} Daten

Diese Rollen müssen mit der Rolle *Instance Observer* oder einer der xref:scoped[Scoped Roles] (siehe unten) kombiniert werden.  Andernfalls ist kein Zugriff auf die Daten von {stackstate-product-name} möglich und die Benutzeroberfläche zeigt die Meldung "Keine Komponenten gefunden" an.  Dies gilt für alle Rancher-Benutzer, einschließlich der Benutzer, wie z. B. Projektbesitzer.

Instanz Empfohlener Zugriff:: Erteilt die empfohlenen Berechtigungen für die Verwendung von SUSE Observability.  Diese Rolle umfasst Berechtigungen, die nicht unbedingt erforderlich sind, aber (begrenzte) Möglichkeiten der Personalisierung bieten {stackstate-product-name}.
Instanz Basic Access:: Gewährt minimale Berechtigungen zur Nutzung von {stackstate-product-name}. Diese Rolle muss nicht explizit zugewiesen werden und es gibt keine *Rollenvorlage* für sie; jeder angemeldete Benutzer hat sie. 

Im Folgenden finden Sie die den einzelnen vordefinierten SUSE Observability-Rollen zugewiesenen Berechtigungen. Einzelheiten zu den verschiedenen Berechtigungen und deren Verwaltung über die `sts` CLI finden Sie unter xref:/setup/security/rbac/rbac_permissions.adoc[RBAC-Berechtigungen (Role based access control)]

[tabs]
====
Basic Access::
+
--
Der Basiszugriff gewährt minimale Berechtigungen für die Verwendung von SUSE Observability. Soll mit einem Beobachter (Instanz, Cluster oder Projekt) kombiniert werden.
Diese Berechtigungen werden allen Benutzern gewährt.

|===
|Ressource |Verbs 

|metrische Bindungen |bekommen.
|Einstellungen |bekommen.
|System-Benachrichtigungen |bekommen.
|Ansichten |bekommen.
|===

--
Empfohlener Zugang::
+
--
Empfohlener Zugriff gewährt Berechtigungen, die nicht unbedingt erforderlich sind, die aber den Nutzen von SUSE Observability erheblich steigern. Es bietet ein begrenztes Maß an Personalisierung.
Soll mit einem Beobachter (Instanz, Cluster oder Projekt) kombiniert werden.

|===
|Ressource |Verbs 

|api-tokens |bekommen.
|Favoriten-Tabellen |erstellen, löschen
|Favoriten-Ansichten |erstellen, löschen
|Rucksäcke |bekommen. 
|Visualisierungs-Einstellungen |Update
|===

--
Beobachter::
+
--
Observer gewährt Zugriff auf alle Observability-Daten in einer SUSE Observability-Instanz.  Kombinieren Sie mit *Recommended Access* für ein noch besseres Erlebnis.

|===
|Ressource |Verbs 

|Topologie |bekommen.
|Metriken |bekommen.
|Spuren |bekommen.
|===

--
Störungssucher::
+
--
Die Troubleshooter-Rolle hat Zugriff auf alle in SUSE Observability verfügbaren Daten und die Möglichkeit, Ansichten zu erstellen und Monitore zu aktivieren/deaktivieren.

|===
|Ressource |Verbs 

|Agenten |bekommen. 
|api-tokens |bekommen.
|Komponenten-Aktionen |ausführen.
|Dashboards |abrufen, erstellen, aktualisieren, löschen 
|Favoriten-Tabellen |erstellen, löschen
|Favoriten-Ansichten |erstellen, löschen
|metrische Bindungen |bekommen.
|Metriken |bekommen. 
|überwacht |abrufen, erstellen, aktualisieren, löschen, ausführen 
|Benachrichtigungen |abrufen, erstellen, aktualisieren, löschen 
|Einstellungen |bekommen. 
|Stackpack-Konfigurationen |abrufen, erstellen, aktualisieren, löschen
|Rucksäcke |bekommen. 
|System-Benachrichtigungen |bekommen.
|Topologie |bekommen. 
|Spuren |bekommen. 
|Ansichten |abrufen, erstellen, aktualisieren, löschen 
|Visualisierungs-Einstellungen |bekommen.
|===

--
Admin::
+
--
Die Rolle Administrator verfügt über alle zugewiesenen Berechtigungen.

|===
|Ressource |Verbs 

|Agenten |bekommen. 
|api-tokens |bekommen.
|Komponenten-Aktionen |ausführen.
|Dashboards |abrufen, erstellen, aktualisieren, löschen 
|Favoriten-Tabellen |erstellen, löschen
|Favoriten-Ansichten |erstellen, löschen
|ingestion-api-keys |abrufen, erstellen, aktualisieren, löschen
|metrische Bindungen |bekommen.
|Metriken |bekommen. 
|überwacht |abrufen, erstellen, aktualisieren, löschen, ausführen 
|Benachrichtigungen |abrufen, erstellen, aktualisieren, löschen 
|Berechtigungen |abrufen, erstellen, aktualisieren, löschen 
|Skripte mit eingeschränktem Zugriff |ausführen.
|Service-Tokens |abrufen, erstellen, aktualisieren, löschen
|Einstellungen |abrufen, erstellen, aktualisieren, löschen, entsperren 
|Stackpack-Konfigurationen |abrufen, erstellen, aktualisieren, löschen
|Rucksäcke |erhalten, erstellen 
|sync-data |holen, aktualisieren, löschen
|System-Benachrichtigungen |bekommen.
|Themen-Meldungen |bekommen.
|Topologie |bekommen. 
|Spuren |bekommen. 
|Ansichten |abrufen, erstellen, aktualisieren, löschen 
|Visualisierungs-Einstellungen |Update
|===

--
====

[#scoped]
== Umfassende Rollen

Sie können den Benutzern oder Gruppen in einem beobachteten Cluster die folgenden *Rollenvorlagen* zuweisen.  Sie gewähren Zugriff auf {stackstate-product-name} Daten, die von (einem *Projekt* in) dem *Cluster* stammen, und geben einem Benutzer die Berechtigung, Topologie, Metriken, Protokolle und Trace-Daten zu lesen.

Beobachter:: Ermöglicht den Zugriff auf Daten, die aus Namespaces in einem *Projekt* stammen. Sie können dies im Abschnitt *Projektzugehörigkeit* der Clusterkonfiguration verwenden.
Cluster-Beobachter:: Ermöglicht den Zugriff auf alle Daten, die von einem *Cluster* kommen. Sie können diese Vorlage im Abschnitt *Clustermitgliedschaft* der Clusterkonfiguration verwenden.

Die Ressourcen in diesen Rollen entsprechen den xref:/setup/security/rbac/rbac_permissions.adoc#_scoped_permissions["Scoped Permissions]". Sie sind in der API-Gruppe `scope.observability.cattle.io` verfügbar (mit dem Verb `get`, da diese Ressourcen nur lesbar sind):

* `topology` - Komponenten (Bereitstellungen, Pods usw.) aus dem Cluster oder Namensraum
* `traces` - Spans aus dem Cluster oder Namespace
* `metrics` - metrische Daten, die aus dem Cluster oder Namensraum stammen

Beachten Sie, dass der Zugriff auf die Protokolle über die Ressource `topology` gesteuert wird.

Aktivieren Sie die Personalisierung für Benutzer mit diesen Beobachterrollen, indem Sie auf dem *Projekt*, auf dem {stackstate-product-name} läuft, die Rolle " *Instance Recommended Access"* vergeben.

== Benutzerdefinierte Rollen

Um zusätzliche Berechtigungen über den empfohlenen Zugriff hinaus zu gewähren, erstellen Sie in Rancher ein benutzerdefiniertes Project *RoleTemplate*, das von *SUSE Observability Instance Recommended Access* erbt.  Um beispielsweise die Rechte zum Anzeigen von Monitoren und Metrikdiagrammen zu gewähren, fügen Sie Regeln mit hinzu:

* Verb: `get`
* Ressource: `metricbindings` und `monitors`
* ApiGroup: `instance.observability.cattle.io`

image::rancher-custom-role.png[Benutzerdefiniertes RoleTemplate für umfassenderen Zugriff]

Sie können jede in den xref:/setup/security/rbac/rbac_permissions.adoc[RBAC-Berechtigungen] definierte Kombination aus Ressource und Verb angeben.  Beachten Sie, dass die Bindestriche (`-`) aus den Ressourcennamen entfernt werden, so dass die Berechtigung `get-metric-bindings` zur Kubernetes RBAC-Ressource `metricbindings` mit dem Verb `get` wird.


== Fehlersuche

* Überprüfen Sie, ob der Rbac-Agent für den Cluster mit der Plattform kommunizieren kann.

* xref:/setup/security/rbac/rbac_permissions.adoc#_list_subjects_for_a_user[Überprüfen Sie die Benutzersubjekte] (Benutzer und Rollen).
  ** Überprüfen Sie alle Rollenkonfigurationen auf dem OIDC-Anbieter.
* xref:/setup/security/rbac/rbac_permissions.adoc#_show_granted_permissions[Prüfen Sie den Gegenstand der Genehmigung]
  ** Überprüfen Sie, ob die relevanten (Cluster)RoleBindings, die dem Benutzer mit einer (Cluster)Role entsprechen, vorhanden sind.
  ** Überprüfen Sie die (Cluster)Rolle, um sicherzustellen, dass sie die richtigen Berechtigungen gewährt.
